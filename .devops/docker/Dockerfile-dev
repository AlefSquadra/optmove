FROM node:latest

WORKDIR /app

COPY . .

RUN rm -rf node_modules
RUN npm install
RUN npm run build

ARG VITE_APP_BASE_URL_BACKEND
ARG VITE_APP_API_POWER_BI
ARG VITE_APP_API_PTB
ARG VITE_APP_API_PTB_HOM
ARG VITE_APP_AUTHORITY
ARG VITE_APP_CLIENT_ID
ARG VITE_APP_ENVIRONMENT
ARG VITE_APP_REDIRECT_URI

ENV VITE_APP_BASE_URL_BACKEND=$VITE_APP_BASE_URL_BACKEND
ENV VITE_APP_API_POWER_BI=$VITE_APP_API_POWER_BI
ENV VITE_APP_API_PTB=$VITE_APP_API_PTB
ENV VITE_APP_API_PTB_HOM=$VITE_APP_API_PTB_HOM
ENV VITE_APP_AUTHORITY=$VITE_APP_AUTHORITY
ENV VITE_APP_CLIENT_ID=$VITE_APP_CLIENT_ID
ENV VITE_APP_ENVIRONMENT=$VITE_APP_ENVIRONMENT
ENV VITE_APP_REDIRECT_URI=$VITE_APP_REDIRECT_URI

EXPOSE 4173

CMD ["npm", "run", "preview"]